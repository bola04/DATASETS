<!DOCTYPE html>
<html>
 <head>
  <title>
   OneDirect: Login
  </title>
  <meta content="initial-scale=1, maximum-scale=1" name="viewport"/>
  <meta content="OneDirect is India's leading omni-channel 'Customer Engagement Platform' built for enterprises that enables hyper-personalized and contextual marketing to an audience of one." name="description"/>
  <script>
   window.location.hreh = "/sso/login";
  </script>
  <!-- Mandatory files for login and validation. Plz do not remove from Head Section -->
  <script src="../util/config.js?v=116">
  </script>
  <script src="../util/sessionStorageKey.js?v=116">
  </script>
  <script src="../util/type/roleType.js?v=116">
  </script>
  <script src="../util/validateLoginUser.js?v=122">
  </script>
  <!--END : Mandatory files for login and validation. Plz do not remove from Head Section -->
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css"/>
  <style type="text/css">
   @font-face {
            font-family: 'FontAwesome';
            src: url('/static/brand-dashboard/components/fontawesome/fonts/fontawesome-webfont.eotfontawesome-webfont.eot?v=3.2.1');
            src: url('/static/brand-dashboard/components/fontawesome/fonts/fontawesome-webfont.eot?#iefix&v=3.2.1') format('embedded-opentype'),
            url('/static/brand-dashboard/components/fontawesome/fonts/fontawesome-webfont.woff?v=3.2.1') format('woff'),
            url('/static/brand-dashboard/components/fontawesome/fonts/fontawesome-webfont.ttf?v=3.2.1') format('truetype'),
            url('/static/brand-dashboard/components/fontawesome/fonts/fontawesome-webfont.svg#fontawesomeregular?v=3.2.1') format('svg');
            font-weight: normal;
            font-style: normal;
        }
  </style>
  <style>
   body, html {
            width: 100%;
            height: 100%;
            background: #3b718b !important;
            font-family: 'Lato', sans-serif;
        }

        ._center_box ._logo_box {
            background-color: #1e2635;
        }

        .caret.r {
            border-top: 6px solid transparent !important;
            margin: 0;
            border-right: 6px solid transparent;
            border-left: 6px solid;
            border-bottom: 6px solid transparent;
            margin-left: 2px;
        }

        .login-form label {
            cursor: auto
        }

        .loading {
            background: rgba(100, 100, 100, 0.4);
            position: aboslute;
            z-index: 10;
            width: 100%;
            height: 100%;
            display: none;
        }
  </style>
  <link href="/static/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="/static/onedirect-assets/css/style.css" rel="stylesheet"/>
  <link href="/static/onedirect-assets/css/foundation.min.css" rel="stylesheet"/>
  <link href="/static/onedirect-assets/css/newStyles.css" rel="stylesheet"/>
 </head>
 <body>
  <div class="loading">
  </div>
  <div class="wrapper">
   <div class="_center_box col-md-6" style="background: fff !important">
    <!-- Description text-->
    <div class=" _color_444 ">
     <div class="text-center logo-box">
      <a href="http://www.onedirect.in">
       <img src="/static/cached/images/onedirect-images/onedirect_logo.png"/>
      </a>
     </div>
     <form id="frmLogin">
      <h5>
       Sign in to your account
      </h5>
      <div class="form-group ff_menu _fs_14 _ls_1 _txt_ucs">
       <div class="col-sm-12">
        <input class="form-control text-box" data-name="login_emailId" id="inputEmail3" name="username" placeholder="Email" type="email"/>
       </div>
      </div>
      <div class="form-group ff_menu _fs_14 _ls_1 _txt_ucs">
       <div class="col-sm-12">
        <input class="form-control text-box pass" id="inputPassword3" name="password" placeholder="Password" type="password"/>
       </div>
      </div>
      <div class="form-group rem-me">
       <div class="col-md-6">
        <div class="checkbox">
         <input class="styled checkbox hide" id="remember-me" type="checkbox" value="true"/>
         <label class="inlineCheckbox1" for="remember-me">
          Remember
                        me
         </label>
        </div>
       </div>
       <div class="col-md-6">
        <a class="open-forget-popup _14p" data-reveal-id="password-popup" href="#">
         Forgot password?
        </a>
       </div>
      </div>
      <div class="form-group">
       <div class="col-sm-12 _ff_body ">
        <input class="btn btn-default btn-success btn-signin col-md-12 _fs_18" id="signbtn" type="button" value="Sign in"/>
       </div>
      </div>
     </form>
     <form action="#" class="form-horizontal login-form" id="activateform" method="post" onsubmit="activateform(this)">
      <h5>
       Activate your account
      </h5>
      <div class="form-group ff_menu _fs_14 _ls_1 _txt_ucs">
       <div class="col-sm-12">
        <input class="form-control text-box" data-name="login_emailId" disabled="" id="inputEmail3" name="activateemail" placeholder="Email" type="email"/>
       </div>
      </div>
      <div class="form-group ff_menu _fs_14 _ls_1 _txt_ucs">
       <div class="col-sm-12">
        <input class="form-control text-box pass" id="activatefullname" name="activatefullname" placeholder="Full Name" type="text"/>
       </div>
      </div>
      <div class="form-group ff_menu _fs_14 _ls_1 _txt_ucs">
       <div class="col-sm-12">
        <input class="form-control text-box pass activatepass" id="activatepass" minlength="8" name="enterpass1" placeholder="Password" type="password"/>
       </div>
      </div>
      <div class="form-group ff_menu _fs_14 _ls_1 _txt_ucs">
       <div class="col-sm-12">
        <input class="form-control text-box pass activateconfirmpass" id="enterpass2" name="enterpass2" placeholder="Confirm Password" type="password"/>
        <span class="activateconfirmpasserror" id="" style="color: rgba(255, 0, 0, 0.65); width: 100%; text-transform: lowercase">
        </span>
       </div>
      </div>
      <div class="form-group">
       <div class="col-sm-12 _ff_body ">
        <input class="btn btn-default btn-success btn-signin col-md-12 _fs_18" id="activatebtn" onclick="activateAcc(event)" value="Submit"/>
       </div>
      </div>
     </form>
     <form class="form-horizontal forgot " id="frmForgotpassword" method="post">
      <div class="passwordrecovery" style="display: block;">
       <div class="pass-content">
        <h5 style="margin: 0 0 10px 0">
         Forgot Password?
        </h5>
        <label class="label-text" for="txtEmailForgot" style="margin: 0 0 30px 0">
         Enter the registered email id to
                            reset your password.
        </label>
        <div class="form-group ff_menu _fs_14 _ls_1 _txt_ucs">
         <div class="col-sm-12">
          <input class="_13p rounded-4 text-box mar-bottom-pass passinput" data-name="data_passwordRecovery" id="txtEmailForgot" name="forgotemailinput" placeholder="Email" type="text"/>
          <span class="passerror" id="forgot" style="color: rgba(255, 0, 0, 0.65); width: 100%; text-transform: lowercase">
          </span>
         </div>
        </div>
       </div>
       <button class="btn btn-default btn-success btn-signin col-md-12 _fs_18" id="forgotbt" onclick="SendPassword(event)">
        Submit
       </button>
       <span class="login_screen">
        Click
        <a class="login_screen_back" href="#">
         here
        </a>
        to login
       </span>
      </div>
     </form>
     <form class="form-horizontal" id="resetpassword" method="post">
      <div class="resetpassbox">
       <div class="resetpass-content">
        <h5 style="margin: 0 0 10px 0">
         Reset Password
        </h5>
        <label class="label-text" for="txtEmailForgot" style="margin: 0 0 30px 0">
         Password should consist of minimum 8
                            characters With atleast one alphabet and one numeric.
        </label>
        <div class="form-group ff_menu _fs_14 _ls_1 _txt_ucs">
         <div class="col-sm-12">
          <input class="_13p rounded-4 text-box mar-bottom-pass resetpassinput " id="newpassword" minlength="8" name="enterpass" placeholder="Enter Password" type="password"/>
          <span class="enterpasserror" style="color: rgba(255, 0, 0, 0.65); width: 100%; text-transform: lowercase">
          </span>
         </div>
        </div>
        <div class="form-group ff_menu _fs_14 _ls_1 _txt_ucs">
         <div class="col-sm-12">
          <input class="_13p rounded-4 text-box mar-bottom-pass confirmpassinput " id="cnfpass" name="confirmpass" placeholder="Confirm Password" type="password"/>
          <span class="confirmpasserror" style="color: rgba(255, 0, 0, 0.65); width: 100%; text-transform: lowercase">
          </span>
          <input class="_13p rounded-4 text-box mar-bottom-pass resetpassinput " id="token_name" name="token" type="hidden"/>
          <input class="_13p rounded-4 text-box mar-bottom-pass resetpassinput " id="brand-user-id" name="brandUserId" type="hidden"/>
          <input class="_13p rounded-4 text-box mar-bottom-pass resetpassinput " id="brand-id" name="brandId" type="hidden"/>
         </div>
        </div>
       </div>
       <button class="btn btn-default btn-success btn-signin col-md-12 _fs_18" id="passbtn" onclick="resetPassword(event)">
        Submit
       </button>
      </div>
     </form>
     <div aria-hidden="true" aria-labelledby="modalTitle" class="reveal-modal small" data-reveal="" id="password-popup" role="dialog">
      <form id="frmForgotpassword" method="post">
       <div class="passwordrecovery" style="display: block;">
        <span id="forgot" style="color: rgba(255, 0, 0, 0.65);">
        </span>
        <h3 class="_20p w700">
         Password recovery
        </h3>
        <label for="txtEmailForgot">
         Email id
        </label>
        <input class="_13p rounded-4" data-name="data_passwordRecovery" id="txtEmailForgot" name="forgotemailinput" placeholder="Please enter your email id." type="text"/>
        <br/>
        <button class="_12p cta-btn rounded-6 recover-btn db center" id="forgotbt" onclick="SendPassword(event)">
         Send password to my email address
         <span class="caret r six">
         </span>
        </button>
       </div>
      </form>
      <a aria-label="Close" class="close-reveal-modal">
       Ã—
      </a>
     </div>
    </div>
   </div>
   <div class="footer-row pull-left text-center">
    <p>
     For any queries write to us at
     <span class="mail-text">
      <a href="mailto:clientcare@onedirect.in">
       clientcare@onedirect.in
      </a>
     </span>
    </p>
    <div class="follow-box">
     <span class="follow">
      Follow us on
     </span>
     <ul class="social-links">
      <li>
       <a href="https://twitter.com/Onedirectcx" target="_blank">
        <img src="/static/cached/images/onedirect-images/twitter-social.png"/>
       </a>
      </li>
      <li>
       <a href="https://www.linkedin.com/company/onedirect---the-customer-engagement-platform" target="_blank">
        <img src="/static/cached/images/onedirect-images/in-social.png"/>
       </a>
      </li>
     </ul>
    </div>
   </div>
  </div>
  <div class="loader-overlay">
   <img src="/static/cached/images/onedirect-images/loader12.GIF"/>
  </div>
  <script src="/static/onedirect-assets/js/jquery.js">
  </script>
  <script src="/static/onedirect-assets/js/foundation.min.js">
  </script>
  <script src="/static/js/jquery.validate.js" type="text/javascript">
  </script>
  <script src="/static/js/additional-methods.min.js">
  </script>
  <script>
   // the username and pass is sent in the first call
    // we get a token that has to be sent in the header of the coming calls
    // set the token in the localStorage so that it can be accessed by various tabs and windows
    // refresh the token in every 50 mins by setting an interval
    // check for user activity by an external library and make a call to logout user if there is no user activity
    // how will it work for the admin dashboard and brand dashboard
    // if the login is successful store the token in the localStorage
    // create a method that checks if the localStorage token is present
    // if not redirect to the home page
    // if present then make the api calls to get the initial data with the token in the header


    $ ("#signbtn").click (function () {
        initiateLogin ();
    });


    $ ("#inputEmail3").keypress (function (e) {
        if (e.which == 13) {
            initiateLogin ();
        }
    });

    $ ("#inputPassword3").keypress (function (e) {
        if (e.which == 13) {
            initiateLogin ();
        }
    });

    /**
     * @author : HTIESH
     * This function will capture Email Id and password, Validate it and send it to Login API in case of success validation
     */
    function initiateLogin () {
        var emailId    = $ ("#inputEmail3").val ();
        var password   = $ ("#inputPassword3").val ();
        var domain     = window.location.hostname.substring (0, window.location.hostname.indexOf ("."));
        var rememberMe = $ ("#remember-me").prop ('checked');


        if (validateLoginForm (emailId, password)) {
            var data = {
                "emailId"    : emailId,
                "password"   : password,
                "domain"     : domain,
                "rememberMe" : rememberMe
            };
            doLogin (data);
        }
    }
    ;

    /**
     * @author : HITESH
     * @param EmailId
     * @param Password
     * This function validate is userId and Password is valid to send to Login API. Return true else false in case of failure
     */
    function validateLoginForm (emailId, password) {
        if (emailId == undefined || emailId == null || emailId.trim () == "") {
            alert ("Email Id cannot be blank");
            return false;
        } else if (password == undefined || password == null || password.trim () == "") {
            alert ("Password cannot be blank");
            return false;
        }

        return true;
    }
    ;


    /**
     * @author : HITESH
     * This function calls Login API and check if user is a valid user or not. If not
     * @param data
     */
    function doLogin (data) {

        // window.LOGIN_URL -> coming from config.js
        fetch (window.LOGIN_URLS.LOGIN.URL, {
            method  : window.LOGIN_URLS.LOGIN.METHOD,
            headers : window.LOGIN_URLS.LOGIN.HEADER,
            body    : JSON.stringify (data)
        }).then (function (response) {
            console.log ('original response');
            console.log (response);
            if (response.status != 200) {
                // Login failed
                if (response.status == 401 || response.status == 403) {
                    response.text().then(function(responseText) {
                        responseText && alert(responseText);
                        console.log(responseText);
                    });
                }
                else{
                    response.text().then(function(responseText) {
                        console.log(responseText);
                    });

                }

                throw new Error (response);
            }
            return response.text ();
        }).then (function (responseText) {

            console.log ('response text');
            console.log (responseText);

            var userInfo = parseJwt (responseText);

            storeInformationLocalStorage (userInfo);
            storeBearerToken (responseText);
            redirectToHome (userInfo);

        }).catch (function (response) {
            console.log (response);
            console.log ("Some error occur");
        });
    }







    jQuery('.text-box').keypress(function(key) {
        if(key.charCode == 32 ) return false;
    });
    jQuery("#frmLogin").validate({
        rules: {
            "username": {CheckEmail:true,required:true, email: true},
            "password": {required:true}

        },
        messages: {
            "username": {required:"Email field is required"},
            "password":"Please enter your password.",

        },onfocusout: function (element, event) {
            this.element(element);
        }
    });

    jQuery.validator.addMethod("CheckEmail", function(value, element) {
        return this.optional( element ) || /^[a-zA-Z0-9._-]+@[a-zA-Z0-9-]+\.[a-zA-Z.]{2,5}$/.test( value );
    }, 'Invalid Email ID');

    jQuery("#activateform").validate({
        rules: {
            "activatefullname": {required:true},
            "enterpass1": {enterpassword:true,required:true},
            "enterpass2": {required:true},

        },
        messages: {
            "activatefullname": {required:"Name field is required"},
            "enterpass1": {required:"Password field is required."},
            "enterpass2": {required:"confirm password field is required.."},

        }
    });
    jQuery.validator.addMethod("enterpassword", function(value, element) {
        return this.optional( element ) || /^(?=.*[0-9])(?=.*[a-zA-Z])([a-zA-Z0-9!@#$%\^\&*\)\(+=._-]+)$/.test( value );
        /* 		  return this.optional( element ) || /^(?=.*[0-9])(?=.*[a-zA-Z])([a-zA-Z0-9]+)$/.test( value );
         */		}, 'Password doesnt follow the required format');




    jQuery("#frmForgotpassword").validate({
        rules: {
            "forgotemailinput": {required:true,CheckEmail2:true, email: true},
        },
        messages: {
            "forgotemailinput": {required:"Email field is required"}


        }
    });
    jQuery.validator.addMethod("CheckEmail2", function(value, element) {
        return this.optional( element ) || /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test( value );
    }, 'Invalid Email ID');

    jQuery("#resetpassword").validate({
        rules: {
            "enterpass": {enterpassword:true,required:true},
            "confirmpass": {required:true}

        },
        messages: {
            "enterpass": {required:"Password field is required."},
            "confirmpass":"confirm password field is required.",

        }
    });
    jQuery.validator.addMethod("enterpassword", function(value, element) {

        return this.optional( element ) || /^(?=.*[0-9])(?=.*[a-zA-Z])([a-zA-Z0-9!@#$%\^\&*\)\(+=._-]+)$/.test( value );

        /* 			  return this.optional( element ) || /^(?=.*[0-9])(?=.*[a-zA-Z])([a-zA-Z0-9]+)$/.test( value );
         */			}, 'Password doesnt follow the required format');
    function SendPassword(event){
        if(jQuery("#txtEmailForgot").valid() ){
            jQuery("#forgotbt").attr("disabled","disabled");
            var brandUserEmailId= jQuery("#txtEmailForgot").val();
            jQuery.ajax({
                type: "put",
                url: "/kong/v1/pwd/resetPassword?email="+brandUserEmailId,
                headers:{
                    "Content-Type" :"application/json",
                    "brandUserId" : 93271,
                    "brandId":1
                },
                success :function (response){
                    if(!response) {
                        jQuery("#forgot").show();
                        jQuery("#forgot").css('display','inline-block');
                        jQuery("#forgot").css('margin-bottom','0');
                        jQuery("#forgot").html('Email not found in our records. ');

                        var currenterrorpass = jQuery('.passerror');
                        var currenterrorinpass = jQuery(currenterrorpass).closest('.col-sm-12').find('.passinput');
                        if(jQuery(currenterrorpass).is(':visible')){
                            jQuery(currenterrorinpass).css('border','solid 1px #ec593b');

                        }
                        jQuery("#forgotbt").attr("disabled",false);

                        jQuery("#forgotbt").show();

                    }else {
                        jQuery("#forgot").show();
                        jQuery("#forgot").css('display','inline-block');
                        jQuery("#forgot").css('margin-bottom','0');

                        jQuery('.pass-content').hide();
                        jQuery(".passwordrecovery").html("<h5 style='margin:80px 0 10px 0'> Success!</h5><h6 style='text-align:center;color:#5d6061; font-size:12px;font-weight:normal; margin:0;'></h6><a style='display:block;width:100%;text-align:center;font-size:12px;' class='successMsg'>"+"Password recovery email sent to "+brandUserEmailId +"</a><button class='btn btn-default btn-success btn-signin col-md-12 _fs_18 sign-in-btn'   style='margin:75px 0 0 0'>Sign in </button>");
                        event.preventDefault();

                        event.stopPropagation();
                    }
                }
            });
            event.preventDefault();
            event.stopPropagation();
        }
        else{
            var currentLabel = jQuery('label.error');
            var currentInput = jQuery(currentLabel).closest('.col-sm-12').find('.text-box.error');
            if(jQuery(currentLabel).is(':visible')){
                jQuery(currentInput).css('border','solid 1px #ec593b')
            }
        }
    }

    function showlogin()
    {
        jQuery('.forgot').hide();
        jQuery('.login-form').show();

    }
    jQuery('.login_screen_back').click(function(){
        jQuery('#frmLogin').show();
        jQuery('.passwordrecovery').hide();
    });
    jQuery('#inputEmail3').blur(function(){
        var currentLabel = jQuery(this);
        var currentInput = jQuery(currentLabel).closest('.col-sm-12').find('.text-box');
        if(!jQuery('#inputEmail3').valid()){

            jQuery(currentInput).css('border','solid 1px #ec593b')
        }
        else{
            jQuery(currentInput).css('border','solid 1px #ccc')
        }

    });
    jQuery('#txtEmailForgot').blur(function(){
        var currentLabel = jQuery(this);
        var currentInput = jQuery(currentLabel).closest('.col-sm-12').find('.text-box');
        if(!jQuery('#txtEmailForgot').valid()){

            jQuery(currentInput).css('border','solid 1px #ec593b')
        }
        else{
            jQuery(currentInput).css('border','solid 1px #ccc')
        }

    });

    jQuery('.text-box').keyup(function(e){
        setTimeout(function(){
            var currentLabel = jQuery('label.error');
            var currentInput = jQuery(currentLabel).closest('.col-sm-12').find('.text-box.valid');
            if(jQuery(currentLabel).is(':hidden')){
                jQuery(currentInput).css('border','solid 1px #ccc')
            }
        }, 200);


    });

    jQuery('.text-box').keyup(function(e){
        if(e.keyCode == 8){
            var currentLabel = jQuery('label.error');
            var currentInput = jQuery(currentLabel).closest('.col-sm-12').find('.text-box.valid');
            if(jQuery(currentLabel).is(':hidden')){
                jQuery(currentInput).css('border','solid 1px #ec593b')
            }
        }
    });





    jQuery('.open-forget-popup').click(function(){
        jQuery('.forgot').show();
        jQuery('.passwordrecovery').show();
        jQuery('#frmLogin').hide();


    });


    function valideForm(){
        if(jQuery("#inputEmail3").valid() && jQuery("#inputPassword3").valid() ){
            jQuery("#inputPassword3").val(MD5(jQuery("#inputPassword3").val()));
            //console.log(jQuery("#inputPassword3").val());
        }else{
            var passfield = jQuery('#inputPassword3').val().length;
            if(passfield <=0){
                jQuery('#inputPassword3').css('border','solid 1px #ec593b');
                if($('.emailerror').is(':visible')){
                    $('.emailerror').hide();
                }
            }

            var currentLabel = jQuery('label.error');
            var currentInput = jQuery(currentLabel).closest('.col-sm-12').find('.text-box.error');
            if(jQuery(currentLabel).is(':visible')){
                jQuery(currentInput).css('border','solid 1px #ec593b')
            }
            return false;
        }
    };

    function activateform(){

    };
    function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

    jQuery(document).on("ready",function(){



        jQuery('#inputEmail3').keydown(function(event){
            var key = event.keyCode || event.charCode;

            if( key == 8 ){
                jQuery('.emailerror').hide();
            }
        });
        jQuery('.passinput').keydown(function(event){
            var key = event.keyCode || event.charCode;

            if( key == 8 ){
                jQuery('.passerror').hide();
            }
        });

        jQuery('.sign-in-btn').click(function(){
            jQUery('#resetpassword').hide();
            jQuery('#frmForgotpassword').hide();
            jQuery('.login-form').show();

        });
        jQuery("#resetpassword").on("click",".sign-in-reset",function(){
            window.location = "/";
            return false;

        });


        var username=getParameterByName("userName");
        var error=getParameterByName("errorcode");
        var EmailNotExist=getParameterByName("EmailNotExist");
        if(username){
            jQuery("#inputEmail3").val(username);
        }

        if(error =="1"){
            var passerror = jQuery('#inputPassword3').closest('.col-sm-12');
            jQuery(passerror).append("<div class='emailerror'>You entered a wrong password. Please verify or reset your password by clicking on Forgot Password</div>");

        }else if(error =="2" ){
            var emailerror = jQuery('#inputEmail3').closest('.col-sm-12');
            jQuery(emailerror).append("<div class='emailerror'>This email id doesn't exist. Please verify or contact us</div>");
        }else if(error =="3" ){
            var emailerror = jQuery('#inputEmail3').closest('.col-sm-12');
            jQuery(emailerror).append("<div class='emailerror'>Unauthorized login request.</div>");
        } else if(error =="4" ){
            var passerror = jQuery('#inputPassword3').closest('.col-sm-12');
            jQuery(passerror).append("<div class='emailerror'>Your account has been deactivated. Please contact your administrator.</div>");
        }

        var currenterror = jQuery('.emailerror');
        var currenterrorin = jQuery(currenterror).closest('.col-sm-12').find('.text-box');
        if(jQuery(currenterror).is(':visible')){
            jQuery(currenterrorin).css('border','solid 1px #ec593b')
        }

        jQuery('.pass').keyup(function(e){
            setTimeout(function(){
                var currentLabel = jQuery('.emailerror');
                var currentInput = jQuery(currentLabel).closest('.col-sm-12').find('.text-box');
                jQuery(currentLabel).hide();
                if(jQuery(currentLabel).is(':hidden')){
                    jQuery(currentInput).css('border','solid 1px #ccc');
                }
            }, 200);

        });

    });
    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
    }

    jQuery(document).ready(function() {

        var token = getQueryVariable("pass_reset_key");
        var brandUserId = getQueryVariable("b");
        var brandId = getQueryVariable("i");
            if(token){
            jQuery('#resetpassword').show();
            jQuery('#frmLogin').hide();
            $("#token_name").val(token);
            $("#brand-user-id").val(brandUserId);
            $("#brand-id").val(brandId);
        }
    });


    function resetPassword(event){
        var pass = jQuery('.resetpassinput').val();
        var confirmpass = jQuery('.confirmpassinput').val();
        if(jQuery('#resetpassword').valid()){
            if(pass == confirmpass){
                jQuery('#passbtn').attr("disabled","disabled");
                var data = {
                    "newPassword":jQuery('#newpassword').val(),
                    "brandUserId":jQuery('#brand-user-id').val(),
                    "passResetKey":jQuery('#token_name').val(),
                }
                jQuery.ajax({
                    type: "post",
                    url: "/kong/v1/pwd/updatePassword",
                    headers:{
                        "Content-Type" :"application/json",
                        "brandUserId" : jQuery('#brand-user-id').val(),
                        "brandId":jQuery('#brand-id').val(),
                    },
                    data: JSON.stringify(data),
                    success: function(response) {
                        jQuery('#passbtn').attr("disabled",false);
                        if(response){
                            //jQuery('#resetpassword').submit();
                            jQuery('.resetpass-content').hide();
                            jQuery('#passbtn').hide();
                            jQuery('.resetpassbox').append("<h5 style='margin:80px 0 0 0;'>Password set successfully!</h5><button class='btn btn-default btn-success btn-signin col-md-12 _fs_18 sign-in-reset'   style='margin:90px 0 0 0'>Sign in </button>");
                        }else {
                            jQuery('.resetpass-content').hide();
                            jQuery('#passbtn').hide();
                            jQuery('.resetpassbox').append("<h5 style='margin:80px 0 0 0;color: red;'>"+"Password reset failed. Please try again"+"</h5><button class='btn btn-default btn-success btn-signin col-md-12 _fs_18 sign-in-reset'   style='margin:90px 0 0 0'>Sign in </button>");
                        }
                    },
                    error:function(response){
                        jQuery('#passbtn').attr("disabled",false);
                        jQuery('.resetpass-content').hide();
                        jQuery('#passbtn').hide();
                        jQuery('.resetpassbox').append("<h5 style='margin:80px 0 0 0;color: red;'>"+"Password reset failed. Please try again"+"</h5><button class='btn btn-default btn-success btn-signin col-md-12 _fs_18 sign-in-reset'   style='margin:90px 0 0 0'>Sign in </button>");
                    }
                });



            }
            else{
                jQuery('.confirmpasserror').text('Confirmation password doesnt match with the initial password.');

            }
        }
        event.preventDefault();
        return false;
    };


    function activateAcc(event){
        var pass = jQuery('.activatepass').val();
        var confirmpass = jQuery('.activateconfirmpass').val();
        if(jQuery('#activateform').valid()){
            if(pass == confirmpass){
                jQuery('#activatebtn').attr("disabled","disabled");
                jQuery('.activateconfirmpasserror').hide();
                jQuery.ajax({
                    type: "post",
                    url: "",
                    data: "",
                    success: function(message) {
                        jQuery('#activatebtn').attr("disabled",false);
                    }
                });
            }
            else{
                jQuery('.activateconfirmpasserror').text('Confirmation password doesnt match with the initial password.');

            }
        }
        event.preventDefault();
        return false;
    };
  </script>
 </body>
</html>
