<!DOCTYPE html>
 <html lang="en">
  <head>
   <meta content="noindex, nofollow" name="robots"/>
   <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
   <meta content="utf-8" http-equiv="encoding"/>
   <meta content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, shrink-to-fit=no" name="viewport"/>
   <title>
    NPR Choice page
   </title>
   <link href="https://s.npr.org/templates/css/fonts/Knockout.css" media="screen, print" rel="stylesheet"/>
   <link href="https://s.npr.org/templates/css/fonts/GothamSSm.css" media="screen, print" rel="stylesheet"/>
   <link href="css/choice-stylesheet.css" media="screen, print" rel="stylesheet"/>
  </head>
  <body>
   <main class="content" id="content">
    <header role="banner">
     <img alt="NPR logo" class="npr-logo" src="https://media.npr.org/chrome_svg/npr-logo-color.svg"/>
     <h1 class="header-txt">
      Data Protection Choices
     </h1>
     <div id="npr-rule" role="presentation">
      <span>
      </span>
      <span>
      </span>
     </div>
    </header>
    <section class="main-section">
     <p>
      By choosing “I agree” below, you agree that NPR’s sites use cookies, similar tracking and storage technologies, and information about the device you use to access our sites to enhance your viewing, listening and user experience, personalize content, personalize messages from NPR’s sponsors, provide social media features, and analyze NPR’s traffic. This information is shared with social media services, sponsorship, analytics and other third-party service providers.
      <a href="https://text.npr.org/s.php?sId=609131973#cookiepolicy">
       See details
      </a>
      .
     </p>
     <p class="acceptance-date" id="acceptanceDate">
     </p>
     <div class="user-actions">
      <button class="user-action user-action--accept" id="accept">
       Agree and Continue
      </button>
      <button class="user-action user-action--revoke" id="revoke">
       Revoke Agreement
      </button>
      <a class="user-action user-action--text" href="https://text.npr.org">
       Decline and Visit Plain Text Site
      </a>
     </div>
     <footer class="footer">
      <p>
       NPR’s
       <a href="https://text.npr.org/s.php?sId=179876898">
        Terms of Use
       </a>
       and
       <a href="https://text.npr.org/s.php?sId=609131973">
        Privacy Policy
       </a>
       .
      </p>
     </footer>
    </section>
   </main>
   <script>
    // self executing function here
     (function () {
         var choiceVersion = 1;
 
         // Return true is the origin param is present in the URL
         var hasOrigin = function () {
             var searchParam = window.location.search;
             return searchParam.substr(0, 8) === '?origin=';
         };
 
         // Append choiceRedirect=true to a destination
         // This will tell use that a user has been already redirected by the choice page
         // stopping a potential infinite redirect loop 
         var addChoiceRedirectParam = function (url) {
             var paramControl = '?';
             if (url.includes('?')){
                 paramControl = '&';
             }
             return url + paramControl + 't=' + (new Date()).getTime();
         }
 
         // Redirect made from AKAMAI will include the original
         // destination with the request ex:
         // https://www.npr.org/choice.html?origin=https://www-s1.npr.org/about-npr/178660742/public-radio-finances
         var getDestination = function () {
             var searchParam = window.location.search;
             if (hasOrigin()) {
                 if (searchParam.substr(8)) {
                     return searchParam.substr(8);
                 } else if (document.referrer) {
                     return document.referrer;
                 }
             }
             return 'https://www.npr.org';
         };
 
         var getCookie = function (name) {
             var value = "; " + document.cookie;
             var parts = value.split("; " + name + "=");
             if (parts.length == 2) return parts.pop().split(";").shift();
             return false;
         };
 
         var delete_cookie = function (name) {
             document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:01 GMT;secure;path=/;domain=npr.org;';
         };
 
         var create_cookie = function (name, value) {
             // Cookies have a tendency to expire, so I arbitrarily set the max age to 10 year
             document.cookie = name + '=' + value + ';secure;path=/;domain=npr.org;max-age=315360000;';
         };
 
         // True is user previously accepted the correct version of the consent page
         var hasPreviouslyAcceptedChoiceOptions = function () {
             return getCookie('trackingChoice') && getCookie('choiceVersion') == choiceVersion;
         }
 
         document.getElementById('accept').addEventListener('click', function () {
             var d = new Date();
             var dateOfChoice = d.getTime();
 
             create_cookie('trackingChoice', 'true');
             create_cookie('choiceVersion', choiceVersion);
             create_cookie('dateOfChoice', dateOfChoice);
             window.location = addChoiceRedirectParam(getDestination());
         });
 
         document.getElementById('revoke').addEventListener('click', function () {
             delete_cookie('trackingChoice');
             delete_cookie('choiceVersion');
             delete_cookie('dateOfChoice');
             document.getElementById('acceptanceDate').innerText = '';
             document.getElementById('content').classList.remove('accepted');
         });
 
         if (hasOrigin() && hasPreviouslyAcceptedChoiceOptions()) {
             // If the user has already accepted the choice options
             // and has an origin param in his request
             // We will redirect him to that origin request.
             // This will solve the issue where applications are caching 307 redirects
             window.location = addChoiceRedirectParam(getDestination());
         } else if (hasPreviouslyAcceptedChoiceOptions()) {
             var lastDateOfChoice = getCookie('dateOfChoice');
             var d = new Date(parseInt(lastDateOfChoice, 10));
             var dateString = "On "
                 + (d.getMonth() + 1)
                 + "/"
                 + (d.getDay() + 1)
                 + "/"
                 + d.getFullYear()
                 + " you accepted to the above.";
             document.getElementById('acceptanceDate').innerText = dateString;
             document.getElementById('content').classList.add('accepted');
         }
 
     })();
   </script>
  </body>
 </html>